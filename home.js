init();

function init() {
    addWebsiteEventListener();
    addToolEventListener();
    addBeginSearchEventListener();
    //addCancelSearchEventListener();
    addAppListEventListener();
}

function addToolEventListener() {
    var toolDropdown = $("#toolDropdown")
    var tools = toolDropdown.find("li");
    
    tools.on("click", function(){
        var selectedTool = $(this).text();
        $("#toolText").text(selectedTool);
    });    
}

function addWebsiteEventListener() {
    var websiteDropdown = $("#websiteDropdown");
    var websites = websiteDropdown.find("li");
    
    websites.on("click", function(){
        var selectedWebsite = $(this).text();
        $("#websiteText").text(selectedWebsite);
    });
}

function addBeginSearchEventListener() {
    var beginSearchButton = $("#beginSearchButton");

    beginSearchButton.on("click", function() {
        //check if there is already ongoing search
        $(".loader").removeClass("invisible");
        //preform python search
        var chosenWebsite = $("#websiteText").text().replace("www.", "").replace(".com", "");
        var chosenTool = $("#toolText").text().replace(" ", "_") + ".txt";
        alert(chosenTool);
        alert(chosenWebsite);

        runPyScript(chosenWebsite, chosenTool);
    });
}

function addAppListEventListener() {
    var appList = $("#appList li");

    appList.on("click", function() {
        if($("#appList .active").exists()) {
            var selectedApp = $("#appList .active");
            selectedApp.removeClass("active");
        }
        $(this).addClass("active");
    });
}

function runPyScript(chosenWebsite, chosenTool) {
    $.ajax( {
        type: "GET",
        url: "/search",
        data: { toolFile: chosenTool },
        success : processJsonFile
    });
}

function processJsonFile() {
    alert("webscraping complete");
}

jQuery.fn.exists = function() {
    return this.length > 0;
}